FROM python:3.10-slim

# üîß –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Å–∏—Å—Ç–µ–º–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
RUN apt-get update && apt-get install -y --no-install-recommends \
    git curl build-essential jq gcc libffi-dev libssl-dev libxml2-dev libxslt1-dev zlib1g-dev \
    && rm -rf /var/lib/apt/lists/*

# üîß –°—Ç–≤–æ—Ä—é—î–º–æ —Ä–æ–±–æ—á—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é
WORKDIR /workspace

# üîß –û–Ω–æ–≤–ª—é—î–º–æ pip
RUN pip install --upgrade pip setuptools wheel

# üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —è–¥—Ä–æ PromptBench + JupyterLab
RUN pip install --no-cache-dir \
    jupyterlab ipykernel \
    promptbench \
    transformers \
    openai==0.27.8 \
    httpx==0.24.1 \
    anyio==3.7.1

# üß† –î–æ–¥–∞—Ç–∫–æ–≤–æ: –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –¥–ª—è prompt-level –∞—Ç–∞–∫
RUN pip install --no-cache-dir \
    textattack \
    tensorflow \
    tensorflow_hub

# üß™ (–û–ø—Ü—ñ–π–Ω–æ) –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —è–¥—Ä–æ –≤ Jupyter
RUN python3 -m ipykernel install --user --name=promptbench --display-name "promptbench"

# üóÇÔ∏è –°—Ç–≤–æ—Ä—é—î–º–æ –ø–∞–ø–∫—É –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–∏–∫–ª–∞–¥—ñ–≤
RUN mkdir -p /workspace/examples

# üì• –ö–æ–ø—ñ—é—î–º–æ —Å–∫—Ä–∏–ø—Ç–∏ (–æ–ø—Ü—ñ–π–Ω–æ)
# COPY run_security_eval.py /workspace/
# COPY run_prompt_attack.py /workspace/

# üîß –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –ø–æ—Ä—Ç –¥–ª—è Jupyter
EXPOSE 8888

# üöÄ –ó–∞–ø—É—Å–∫–∞—î–º–æ JupyterLab –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
CMD ["jupyter", "lab", "--ip=0.0.0.0", "--port=8888", "--no-browser", "--allow-root"]

